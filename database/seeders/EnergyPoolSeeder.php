<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\EnergyPool;
use App\Models\User;
use Carbon\Carbon;

class EnergyPoolSeeder extends Seeder
{
    public function run(): void
    {
        $users = User::take(3)->get();
        if ($users->isEmpty()) {
            $this->command->warn('âš ï¸ No hay usuarios disponibles. Saltando EnergyPoolSeeder.');
            return;
        }

        $pools = [
            [
                'pool_number' => 'POOL-TRADING-001',
                'name' => 'Pool de Trading Solar Madrid',
                'description' => 'Pool especializado en trading de energÃ­a solar fotovoltaica en la regiÃ³n de Madrid.',
                'pool_type' => EnergyPool::POOL_TYPE_TRADING,
                'status' => EnergyPool::STATUS_ACTIVE,
                'energy_category' => EnergyPool::ENERGY_CATEGORY_RENEWABLE,
                'total_capacity_mw' => 150.50,
                'available_capacity_mw' => 120.25,
                'reserved_capacity_mw' => 20.00,
                'utilized_capacity_mw' => 110.25,
                'efficiency_rating' => 92.5,
                'availability_factor' => 95.8,
                'capacity_factor' => 78.2,
                'annual_production_mwh' => 1200000.00,
                'monthly_production_mwh' => 100000.00,
                'daily_production_mwh' => 3287.67,
                'hourly_production_mwh' => 136.99,
                'location_address' => 'Parque Solar Madrid Norte, Carretera A-1, Km 15',
                'latitude' => 40.4168,
                'longitude' => -3.7038,
                'region' => 'Madrid',
                'country' => 'EspaÃ±a',
                'commissioning_date' => Carbon::now()->subYears(2),
                'expected_lifespan_years' => 25,
                'construction_cost' => 120000000.00,
                'operational_cost_per_mwh' => 25.50,
                'maintenance_cost_per_mwh' => 8.75,
                'technical_specifications' => 'Paneles monocristalinos de alta eficiencia, inversores centralizados',
                'environmental_impact' => 'ReducciÃ³n de 600,000 kg COâ‚‚ anuales',
                'regulatory_compliance' => 'Cumple normativa RD 244/2019',
                'safety_features' => 'Sistema de desconexiÃ³n automÃ¡tica, vallado perimetral',
                'pool_members' => ['SolarTech Madrid', 'EnergÃ­a Verde S.L.', 'Renovables del Norte'],
                'pool_operators' => ['Operador Principal', 'Operador de Respaldo'],
                'pool_governance' => ['Junta Directiva', 'ComitÃ© TÃ©cnico', 'ComitÃ© de Sostenibilidad'],
                'trading_rules' => ['Precio mÃ­nimo por MWh', 'Horarios de trading', 'Penalizaciones por incumplimiento'],
                'settlement_procedures' => ['LiquidaciÃ³n mensual', 'GarantÃ­as bancarias', 'AuditorÃ­as trimestrales'],
                'risk_management' => ['Seguros de responsabilidad', 'Cobertura de producciÃ³n', 'GestiÃ³n de riesgos meteorolÃ³gicos'],
                'performance_metrics' => ['Factor de capacidad', 'Disponibilidad', 'Eficiencia energÃ©tica'],
                'environmental_data' => ['Emisiones evitadas', 'Huella de carbono', 'Impacto ambiental'],
                'regulatory_documents' => ['Permisos ambientales', 'Licencias de explotaciÃ³n', 'Certificados de origen'],
                'tags' => ['solar', 'trading', 'madrid', 'renovable'],
                'managed_by' => $users->first()->id,
                'created_by' => $users->first()->id,
                'approved_by' => $users->first()->id,
                'approved_at' => Carbon::now()->subMonths(6),
                'notes' => 'Pool de referencia para energÃ­a solar en Madrid',
            ],
            [
                'pool_number' => 'POOL-RESERVE-002',
                'name' => 'Pool de Reserva EÃ³lica Galicia',
                'description' => 'Pool de reserva estratÃ©gica para energÃ­a eÃ³lica en Galicia.',
                'pool_type' => EnergyPool::POOL_TYPE_RESERVE,
                'status' => EnergyPool::STATUS_ACTIVE,
                'energy_category' => EnergyPool::ENERGY_CATEGORY_RENEWABLE,
                'total_capacity_mw' => 200.00,
                'available_capacity_mw' => 180.00,
                'reserved_capacity_mw' => 20.00,
                'utilized_capacity_mw' => 160.00,
                'efficiency_rating' => 88.2,
                'availability_factor' => 92.5,
                'capacity_factor' => 65.8,
                'annual_production_mwh' => 1500000.00,
                'monthly_production_mwh' => 125000.00,
                'daily_production_mwh' => 4109.59,
                'hourly_production_mwh' => 171.23,
                'location_address' => 'Parque EÃ³lico Costa da Morte, A CoruÃ±a',
                'latitude' => 43.2627,
                'longitude' => -8.4115,
                'region' => 'Galicia',
                'country' => 'EspaÃ±a',
                'commissioning_date' => Carbon::now()->subYears(3),
                'expected_lifespan_years' => 20,
                'construction_cost' => 180000000.00,
                'operational_cost_per_mwh' => 22.75,
                'maintenance_cost_per_mwh' => 12.50,
                'technical_specifications' => 'Turbinas eÃ³licas de 3.5 MW, altura de buje 120m',
                'environmental_impact' => 'ReducciÃ³n de 750,000 kg COâ‚‚ anuales',
                'regulatory_compliance' => 'Cumple normativa eÃ³lica nacional',
                'safety_features' => 'Sistema de parada automÃ¡tica, seÃ±alizaciÃ³n aeronÃ¡utica',
                'pool_members' => ['EÃ³lica Galicia', 'Vientos del AtlÃ¡ntico', 'EnergÃ­a Marina S.L.'],
                'pool_operators' => ['Operador EÃ³lico Principal'],
                'pool_governance' => ['Consejo de AdministraciÃ³n', 'ComitÃ© Operativo'],
                'trading_rules' => ['Reserva mÃ­nima del 10%', 'ActivaciÃ³n en 15 minutos'],
                'settlement_procedures' => ['LiquidaciÃ³n diaria', 'GarantÃ­as de reserva'],
                'risk_management' => ['Seguros de viento', 'Cobertura de producciÃ³n'],
                'performance_metrics' => ['Factor de capacidad', 'Disponibilidad tÃ©cnica'],
                'environmental_data' => ['Emisiones evitadas', 'Impacto en avifauna'],
                'regulatory_documents' => ['Permisos ambientales', 'Licencias de explotaciÃ³n'],
                'tags' => ['eolica', 'reserva', 'galicia', 'renovable'],
                'managed_by' => $users->skip(1)->first()->id,
                'created_by' => $users->first()->id,
                'approved_by' => $users->first()->id,
                'approved_at' => Carbon::now()->subMonths(8),
                'notes' => 'Pool estratÃ©gico para estabilidad del sistema',
            ],
            [
                'pool_number' => 'POOL-BALANCING-003',
                'name' => 'Pool de Balanceo HidroelÃ©ctrico',
                'description' => 'Pool especializado en servicios de balanceo del sistema elÃ©ctrico.',
                'pool_type' => EnergyPool::POOL_TYPE_BALANCING,
                'status' => EnergyPool::STATUS_ACTIVE,
                'energy_category' => EnergyPool::ENERGY_CATEGORY_HYBRID,
                'total_capacity_mw' => 75.25,
                'available_capacity_mw' => 70.00,
                'reserved_capacity_mw' => 5.25,
                'utilized_capacity_mw' => 65.00,
                'efficiency_rating' => 95.8,
                'availability_factor' => 98.2,
                'capacity_factor' => 85.5,
                'annual_production_mwh' => 600000.00,
                'monthly_production_mwh' => 50000.00,
                'daily_production_mwh' => 1643.84,
                'hourly_production_mwh' => 68.49,
                'location_address' => 'Central HidroelÃ©ctrica del Duero, Zamora',
                'latitude' => 41.5035,
                'longitude' => -5.7448,
                'region' => 'Castilla y LeÃ³n',
                'country' => 'EspaÃ±a',
                'commissioning_date' => Carbon::now()->subYears(5),
                'expected_lifespan_years' => 50,
                'construction_cost' => 95000000.00,
                'operational_cost_per_mwh' => 15.25,
                'maintenance_cost_per_mwh' => 5.75,
                'technical_specifications' => 'Turbinas Francis de 25 MW, embalse de regulaciÃ³n',
                'environmental_impact' => 'ReducciÃ³n de 300,000 kg COâ‚‚ anuales',
                'regulatory_compliance' => 'Cumple normativa hidroelÃ©ctrica',
                'safety_features' => 'Sistema de alivio de presiÃ³n, monitoreo sÃ­smico',
                'pool_members' => ['HidroelÃ©ctrica del Duero', 'EnergÃ­a HidrÃ¡ulica S.L.'],
                'pool_operators' => ['Operador HidroelÃ©ctrico'],
                'pool_governance' => ['Junta Directiva', 'ComitÃ© TÃ©cnico'],
                'trading_rules' => ['Servicios de balanceo', 'Reserva de regulaciÃ³n'],
                'settlement_procedures' => ['LiquidaciÃ³n horaria', 'Servicios auxiliares'],
                'risk_management' => ['Seguros de responsabilidad', 'GestiÃ³n de caudales'],
                'performance_metrics' => ['Tiempo de respuesta', 'PrecisiÃ³n de regulaciÃ³n'],
                'environmental_data' => ['Impacto en ecosistemas acuÃ¡ticos'],
                'regulatory_documents' => ['ConcesiÃ³n hidroelÃ©ctrica', 'Permisos ambientales'],
                'tags' => ['hidroelectrica', 'balanceo', 'zamora', 'regulacion'],
                'managed_by' => $users->skip(2)->first()->id,
                'created_by' => $users->first()->id,
                'approved_by' => $users->first()->id,
                'approved_at' => Carbon::now()->subMonths(12),
                'notes' => 'Pool crÃ­tico para estabilidad del sistema elÃ©ctrico',
            ],
            [
                'pool_number' => 'POOL-CAPACITY-004',
                'name' => 'Pool de Capacidad de Almacenamiento',
                'description' => 'Pool de almacenamiento energÃ©tico con baterÃ­as de litio.',
                'pool_type' => EnergyPool::POOL_TYPE_CAPACITY,
                'status' => EnergyPool::STATUS_MAINTENANCE,
                'energy_category' => EnergyPool::ENERGY_CATEGORY_STORAGE,
                'total_capacity_mw' => 50.00,
                'available_capacity_mw' => 0.00,
                'reserved_capacity_mw' => 50.00,
                'utilized_capacity_mw' => 0.00,
                'efficiency_rating' => 92.0,
                'availability_factor' => 0.0,
                'capacity_factor' => 0.0,
                'annual_production_mwh' => 0.00,
                'monthly_production_mwh' => 0.00,
                'daily_production_mwh' => 0.00,
                'hourly_production_mwh' => 0.00,
                'location_address' => 'Centro de Almacenamiento EnergÃ©tico, Valencia',
                'latitude' => 39.4699,
                'longitude' => -0.3763,
                'region' => 'Valencia',
                'country' => 'EspaÃ±a',
                'commissioning_date' => Carbon::now()->subMonths(6),
                'expected_lifespan_years' => 15,
                'construction_cost' => 75000000.00,
                'operational_cost_per_mwh' => 35.50,
                'maintenance_cost_per_mwh' => 15.25,
                'technical_specifications' => 'BaterÃ­as de litio-ferrofosfato, sistema de gestiÃ³n BMS',
                'environmental_impact' => 'ReducciÃ³n de 200,000 kg COâ‚‚ anuales',
                'regulatory_compliance' => 'Cumple normativa de almacenamiento',
                'safety_features' => 'Sistema de extinciÃ³n automÃ¡tica, ventilaciÃ³n forzada',
                'pool_members' => ['Almacenamiento EnergÃ©tico S.L.', 'BaterÃ­as del Sur'],
                'pool_operators' => ['Operador de Almacenamiento'],
                'pool_governance' => ['ComitÃ© TÃ©cnico', 'ComitÃ© de Seguridad'],
                'trading_rules' => ['Carga/descarga programada', 'Reserva de capacidad'],
                'settlement_procedures' => ['LiquidaciÃ³n por servicios', 'GarantÃ­as de rendimiento'],
                'risk_management' => ['Seguros de baterÃ­as', 'Cobertura de degradaciÃ³n'],
                'performance_metrics' => ['Eficiencia de carga/descarga', 'Ciclos de vida'],
                'environmental_data' => ['Reciclaje de baterÃ­as', 'Impacto ambiental'],
                'regulatory_documents' => ['Permisos de almacenamiento', 'Certificados de seguridad'],
                'tags' => ['almacenamiento', 'baterias', 'valencia', 'capacidad'],
                'managed_by' => $users->first()->id,
                'created_by' => $users->first()->id,
                'approved_by' => $users->first()->id,
                'approved_at' => Carbon::now()->subMonths(3),
                'notes' => 'En mantenimiento programado - actualizaciÃ³n de sistemas',
            ],
            [
                'pool_number' => 'POOL-DEMAND-005',
                'name' => 'Pool de Respuesta a la Demanda',
                'description' => 'Pool de gestiÃ³n de demanda y respuesta de consumidores.',
                'pool_type' => EnergyPool::POOL_TYPE_DEMAND_RESPONSE,
                'status' => EnergyPool::STATUS_PLANNED,
                'energy_category' => EnergyPool::ENERGY_CATEGORY_DEMAND,
                'total_capacity_mw' => 25.75,
                'available_capacity_mw' => 0.00,
                'reserved_capacity_mw' => 25.75,
                'utilized_capacity_mw' => 0.00,
                'efficiency_rating' => 85.0,
                'availability_factor' => 0.0,
                'capacity_factor' => 0.0,
                'annual_production_mwh' => 0.00,
                'monthly_production_mwh' => 0.00,
                'daily_production_mwh' => 0.00,
                'hourly_production_mwh' => 0.00,
                'location_address' => 'Centro de Control de Demanda, Barcelona',
                'latitude' => 41.3851,
                'longitude' => 2.1734,
                'region' => 'CataluÃ±a',
                'country' => 'EspaÃ±a',
                'commissioning_date' => null,
                'expected_lifespan_years' => 20,
                'construction_cost' => 25000000.00,
                'operational_cost_per_mwh' => 18.75,
                'maintenance_cost_per_mwh' => 8.50,
                'technical_specifications' => 'Sistema de gestiÃ³n de demanda, contadores inteligentes',
                'environmental_impact' => 'ReducciÃ³n de 100,000 kg COâ‚‚ anuales',
                'regulatory_compliance' => 'Cumple normativa de respuesta a demanda',
                'safety_features' => 'Sistema de desconexiÃ³n automÃ¡tica', 'pool_members' => ['GestiÃ³n de Demanda S.L.', 'Consumidores Inteligentes'],
                'pool_operators' => ['Operador de Demanda'],
                'pool_governance' => ['ComitÃ© de Consumidores', 'ComitÃ© TÃ©cnico'],
                'trading_rules' => ['ReducciÃ³n de demanda', 'Incentivos por participaciÃ³n'],
                'settlement_procedures' => ['LiquidaciÃ³n por reducciÃ³n', 'Bonificaciones'],
                'risk_management' => ['Seguros de responsabilidad', 'GarantÃ­as de respuesta'],
                'performance_metrics' => ['Tiempo de respuesta', 'PrecisiÃ³n de reducciÃ³n'],
                'environmental_data' => ['ReducciÃ³n de emisiones', 'Eficiencia energÃ©tica'],
                'regulatory_documents' => ['Permisos de operaciÃ³n', 'Contratos de respuesta'],
                'tags' => ['demanda', 'respuesta', 'barcelona', 'consumidores'],
                'managed_by' => $users->skip(1)->first()->id,
                'created_by' => $users->first()->id,
                'approved_by' => null,
                'approved_at' => null,
                'notes' => 'Pool en fase de planificaciÃ³n - inicio previsto en 6 meses',
            ],
        ];

        foreach ($pools as $pool) {
            EnergyPool::firstOrCreate(
                ['pool_number' => $pool['pool_number']],
                $pool
            );
        }

        $this->command->info('âœ… EnergyPoolSeeder ejecutado correctamente');
        $this->command->info('ğŸ“Š Pools energÃ©ticos creados: ' . count($pools));
        $this->command->info('ğŸ¯ Tipos de pools: Trading, Reserva, Balanceo, Capacidad, Respuesta a Demanda');
        $this->command->info('ğŸ“ˆ Estados: Activos (3), Mantenimiento (1), Planificados (1)');
        $this->command->info('âš¡ Capacidad total: ' . number_format(collect($pools)->sum('total_capacity_mw'), 2) . ' MW');
        $this->command->info('ğŸŒ± CategorÃ­as: Renovables, HÃ­bridos, Almacenamiento, Demanda');
        $this->command->info('ğŸ“ Regiones: Madrid, Galicia, Castilla y LeÃ³n, Valencia, CataluÃ±a');
        $this->command->info('ğŸ’° InversiÃ³n total: â‚¬' . number_format(collect($pools)->sum('construction_cost'), 2));
        $this->command->info('ğŸ“Š Datos realistas: Capacidades, eficiencias y mÃ©tricas operativas');
    }
}
