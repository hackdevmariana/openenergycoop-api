<?php

namespace Database\Seeders;

use Illuminate\Database\Seeder;
use App\Models\ProductionProject;
use App\Models\User;
use Carbon\Carbon;

class ProductionProjectSeeder extends Seeder
{
    public function run(): void
    {
        $users = User::take(5)->get();
        if ($users->isEmpty()) {
            $this->command->warn('âš ï¸ No hay usuarios disponibles. Saltando ProductionProjectSeeder.');
            return;
        }

        $projects = [
            [
                'project_number' => 'PROJ-SOLAR-001',
                'name' => 'Parque Solar Fotovoltaico Madrid Norte',
                'description' => 'InstalaciÃ³n de 50 MW de energÃ­a solar fotovoltaica en el norte de Madrid.',
                'project_type' => ProductionProject::PROJECT_TYPE_SOLAR_FARM,
                'status' => ProductionProject::STATUS_IN_PROGRESS,
                'priority' => ProductionProject::PRIORITY_HIGH,
                'start_date' => Carbon::now()->subMonths(6),
                'expected_completion_date' => Carbon::now()->addMonths(6),
                'budget' => 45000000.00,
                'spent_amount' => 22500000.00,
                'remaining_budget' => 22500000.00,
                'planned_capacity_mw' => 50.00,
                'actual_capacity_mw' => 25.00,
                'efficiency_rating' => 92.5,
                'location_address' => 'Parque Solar Madrid Norte, Carretera A-1, Km 15',
                'latitude' => 40.4168,
                'longitude' => -3.7038,
                'technical_specifications' => 'Paneles monocristalinos de alta eficiencia, inversores centralizados',
                'environmental_impact' => 'ReducciÃ³n de 25,000 toneladas COâ‚‚ anuales',
                'regulatory_compliance' => 'Cumple normativa RD 244/2019',
                'safety_measures' => 'Sistema de desconexiÃ³n automÃ¡tica, vallado perimetral',
                'project_team' => ['Ingeniero Jefe', 'Supervisor de Obra', 'TÃ©cnico de Seguridad'],
                'stakeholders' => ['Ayuntamiento de Madrid', 'Red ElÃ©ctrica de EspaÃ±a'],
                'contractors' => ['SolarTech S.L.', 'Instalaciones ElÃ©ctricas Norte'],
                'suppliers' => ['PanelSolar Corp', 'InversorMax S.A.'],
                'milestones' => ['CimentaciÃ³n completada', 'InstalaciÃ³n de paneles 50%', 'ConexiÃ³n a red'],
                'risks' => ['Retrasos meteorolÃ³gicos', 'Escasez de materiales'],
                'mitigation_strategies' => ['PlanificaciÃ³n flexible', 'Contratos de suministro garantizado'],
                'quality_standards' => ['ISO 9001', 'CertificaciÃ³n CE'],
                'documentation' => ['Plan de proyecto', 'Estudios ambientales', 'Permisos'],
                'tags' => ['solar', 'fotovoltaico', 'madrid', 'renovable'],
                'project_manager' => $users->first()->id,
                'created_by' => $users->first()->id,
                'approved_by' => $users->skip(1)->first()->id,
                'approved_at' => Carbon::now()->subMonths(8),
                'notes' => 'Proyecto prioritario para cumplir objetivos de renovables',
            ],
            [
                'project_number' => 'PROJ-WIND-002',
                'name' => 'Parque EÃ³lico Costa da Morte',
                'description' => 'InstalaciÃ³n de 30 MW de energÃ­a eÃ³lica en la costa gallega.',
                'project_type' => ProductionProject::PROJECT_TYPE_WIND_FARM,
                'status' => ProductionProject::STATUS_APPROVED,
                'priority' => ProductionProject::PRIORITY_MEDIUM,
                'start_date' => Carbon::now()->addMonths(2),
                'expected_completion_date' => Carbon::now()->addMonths(14),
                'budget' => 36000000.00,
                'spent_amount' => 0.00,
                'remaining_budget' => 36000000.00,
                'planned_capacity_mw' => 30.00,
                'actual_capacity_mw' => 0.00,
                'efficiency_rating' => 0.00,
                'location_address' => 'Costa da Morte, A CoruÃ±a',
                'latitude' => 43.2627,
                'longitude' => -8.4115,
                'technical_specifications' => 'Turbinas eÃ³licas de 3 MW, altura de buje 120m',
                'environmental_impact' => 'ReducciÃ³n de 15,000 toneladas COâ‚‚ anuales',
                'regulatory_compliance' => 'Cumple normativa eÃ³lica nacional',
                'safety_measures' => 'Sistema de parada automÃ¡tica, seÃ±alizaciÃ³n aeronÃ¡utica',
                'project_team' => ['Director de Proyecto', 'Ingeniero EÃ³lico'],
                'stakeholders' => ['Xunta de Galicia', 'Red ElÃ©ctrica de EspaÃ±a'],
                'contractors' => ['EÃ³lica Galicia S.L.'],
                'suppliers' => ['WindPower Corp', 'TowerTech S.A.'],
                'milestones' => ['Estudios de viento', 'InstalaciÃ³n de turbinas', 'ConexiÃ³n a red'],
                'risks' => ['Condiciones meteorolÃ³gicas adversas', 'Protestas locales'],
                'mitigation_strategies' => ['Estudios detallados', 'ComunicaciÃ³n con comunidades'],
                'quality_standards' => ['ISO 14001', 'CertificaciÃ³n IEC'],
                'documentation' => ['Estudio de impacto ambiental', 'Permisos administrativos'],
                'tags' => ['eolica', 'galicia', 'costa', 'renovable'],
                'project_manager' => $users->skip(1)->first()->id,
                'created_by' => $users->first()->id,
                'approved_by' => $users->skip(2)->first()->id,
                'approved_at' => Carbon::now()->subMonths(1),
                'notes' => 'Proyecto en fase de planificaciÃ³n avanzada',
            ],
            [
                'project_number' => 'PROJ-HYDRO-003',
                'name' => 'Central HidroelÃ©ctrica del Duero',
                'description' => 'ModernizaciÃ³n de central hidroelÃ©ctrica de 25 MW en Zamora.',
                'project_type' => ProductionProject::PROJECT_TYPE_HYDROELECTRIC,
                'status' => ProductionProject::STATUS_COMPLETED,
                'priority' => ProductionProject::PRIORITY_MEDIUM,
                'start_date' => Carbon::now()->subYears(2),
                'expected_completion_date' => Carbon::now()->subMonths(3),
                'actual_completion_date' => Carbon::now()->subMonths(2),
                'budget' => 28000000.00,
                'spent_amount' => 27500000.00,
                'remaining_budget' => 500000.00,
                'planned_capacity_mw' => 25.00,
                'actual_capacity_mw' => 25.00,
                'efficiency_rating' => 95.8,
                'location_address' => 'Central HidroelÃ©ctrica del Duero, Zamora',
                'latitude' => 41.5035,
                'longitude' => -5.7448,
                'technical_specifications' => 'Turbinas Francis modernizadas, sistema de control digital',
                'environmental_impact' => 'Mejora de eficiencia, reducciÃ³n de emisiones',
                'regulatory_compliance' => 'Cumple normativa hidroelÃ©ctrica actualizada',
                'safety_measures' => 'Sistema de alivio de presiÃ³n, monitoreo sÃ­smico',
                'project_team' => ['Ingeniero HidrÃ¡ulico', 'Supervisor de ModernizaciÃ³n'],
                'stakeholders' => ['ConfederaciÃ³n HidrogrÃ¡fica del Duero'],
                'contractors' => ['HidroelÃ©ctrica del Duero S.L.'],
                'suppliers' => ['HydroTurbine Corp', 'ControlSystems S.A.'],
                'milestones' => ['Desmantelamiento antiguo', 'InstalaciÃ³n nueva', 'Pruebas de funcionamiento'],
                'risks' => ['InterrupciÃ³n del suministro', 'Problemas tÃ©cnicos'],
                'mitigation_strategies' => ['Plan de contingencia', 'Equipos de respaldo'],
                'quality_standards' => ['ISO 9001', 'Normativa hidroelÃ©ctrica'],
                'documentation' => ['Memoria tÃ©cnica', 'Certificados de conformidad'],
                'tags' => ['hidroelectrica', 'modernizacion', 'zamora', 'duero'],
                'project_manager' => $users->skip(2)->first()->id,
                'created_by' => $users->first()->id,
                'approved_by' => $users->skip(1)->first()->id,
                'approved_at' => Carbon::now()->subYears(2)->addMonths(1),
                'notes' => 'Proyecto completado exitosamente, superando expectativas',
            ],
            [
                'project_number' => 'PROJ-STORAGE-004',
                'name' => 'Sistema de Almacenamiento EnergÃ©tico Valencia',
                'description' => 'InstalaciÃ³n de sistema de baterÃ­as de 20 MW para almacenamiento energÃ©tico.',
                'project_type' => ProductionProject::PROJECT_TYPE_STORAGE,
                'status' => ProductionProject::STATUS_PLANNING,
                'priority' => ProductionProject::PRIORITY_HIGH,
                'start_date' => Carbon::now()->addMonths(3),
                'expected_completion_date' => Carbon::now()->addMonths(15),
                'budget' => 32000000.00,
                'spent_amount' => 0.00,
                'remaining_budget' => 32000000.00,
                'planned_capacity_mw' => 20.00,
                'actual_capacity_mw' => 0.00,
                'efficiency_rating' => 0.00,
                'location_address' => 'Centro de Almacenamiento EnergÃ©tico, Valencia',
                'latitude' => 39.4699,
                'longitude' => -0.3763,
                'technical_specifications' => 'BaterÃ­as de litio-ferrofosfato, sistema de gestiÃ³n BMS',
                'environmental_impact' => 'ReducciÃ³n de 10,000 toneladas COâ‚‚ anuales',
                'regulatory_compliance' => 'Cumple normativa de almacenamiento',
                'safety_measures' => 'Sistema de extinciÃ³n automÃ¡tica, ventilaciÃ³n forzada',
                'project_team' => ['Ingeniero de Almacenamiento', 'Especialista en BaterÃ­as'],
                'stakeholders' => ['Generalitat Valenciana', 'Red ElÃ©ctrica de EspaÃ±a'],
                'contractors' => ['Almacenamiento EnergÃ©tico S.L.'],
                'suppliers' => ['BatteryTech Corp', 'PowerManagement S.A.'],
                'milestones' => ['DiseÃ±o tÃ©cnico', 'InstalaciÃ³n de baterÃ­as', 'Pruebas de sistema'],
                'risks' => ['Escasez de materiales', 'Problemas tÃ©cnicos'],
                'mitigation_strategies' => ['Contratos de suministro', 'Equipos de respaldo'],
                'quality_standards' => ['ISO 9001', 'CertificaciÃ³n de baterÃ­as'],
                'documentation' => ['Estudio tÃ©cnico', 'Plan de seguridad'],
                'tags' => ['almacenamiento', 'baterias', 'valencia', 'sistema'],
                'project_manager' => $users->skip(3)->first()->id,
                'created_by' => $users->first()->id,
                'approved_by' => null,
                'approved_at' => null,
                'notes' => 'Proyecto en fase de planificaciÃ³n inicial',
            ],
            [
                'project_number' => 'PROJ-GRID-005',
                'name' => 'ActualizaciÃ³n de Red ElÃ©ctrica Barcelona',
                'description' => 'ModernizaciÃ³n de infraestructura de red elÃ©ctrica en Barcelona.',
                'project_type' => ProductionProject::PROJECT_TYPE_GRID_UPGRADE,
                'status' => ProductionProject::STATUS_ON_HOLD,
                'priority' => ProductionProject::PRIORITY_URGENT,
                'start_date' => Carbon::now()->subMonths(4),
                'expected_completion_date' => Carbon::now()->addMonths(8),
                'budget' => 15000000.00,
                'spent_amount' => 5000000.00,
                'remaining_budget' => 10000000.00,
                'planned_capacity_mw' => 0.00,
                'actual_capacity_mw' => 0.00,
                'efficiency_rating' => 0.00,
                'location_address' => 'Red ElÃ©ctrica Barcelona, CataluÃ±a',
                'latitude' => 41.3851,
                'longitude' => 2.1734,
                'technical_specifications' => 'Subestaciones modernizadas, lÃ­neas de alta tensiÃ³n',
                'environmental_impact' => 'Mejora de eficiencia de transmisiÃ³n',
                'regulatory_compliance' => 'Cumple normativa de red elÃ©ctrica',
                'safety_measures' => 'Protocolos de seguridad elÃ©ctrica',
                'project_team' => ['Ingeniero de Red', 'Supervisor de Instalaciones'],
                'stakeholders' => ['Generalitat de Catalunya', 'Endesa'],
                'contractors' => ['Red ElÃ©ctrica Barcelona S.L.'],
                'suppliers' => ['GridTech Corp', 'PowerLines S.A.'],
                'milestones' => ['PlanificaciÃ³n de cortes', 'InstalaciÃ³n de equipos', 'Pruebas de red'],
                'risks' => ['Interrupciones de servicio', 'Problemas de permisos'],
                'mitigation_strategies' => ['Plan de cortes programados', 'GestiÃ³n de permisos'],
                'quality_standards' => ['ISO 9001', 'Normativa elÃ©ctrica'],
                'documentation' => ['Plan de proyecto', 'Estudios de impacto'],
                'tags' => ['red', 'electricidad', 'barcelona', 'modernizacion'],
                'project_manager' => $users->skip(4)->first()->id,
                'created_by' => $users->first()->id,
                'approved_by' => $users->skip(1)->first()->id,
                'approved_at' => Carbon::now()->subMonths(6),
                'notes' => 'Proyecto en espera por problemas de permisos municipales',
            ],
        ];

        foreach ($projects as $project) {
            ProductionProject::firstOrCreate(
                ['project_number' => $project['project_number']],
                $project
            );
        }

        $this->command->info('âœ… ProductionProjectSeeder ejecutado correctamente');
        $this->command->info('ğŸ“Š Proyectos de producciÃ³n creados: ' . count($projects));
        $this->command->info('ğŸ¯ Tipos de proyectos: Solar, EÃ³lico, HidroelÃ©ctrico, Almacenamiento, Red');
        $this->command->info('ğŸ“ˆ Estados: En Progreso (1), Aprobado (1), Completado (1), PlanificaciÃ³n (1), En Espera (1)');
        $this->command->info('âš¡ Capacidad total planificada: ' . number_format(collect($projects)->sum('planned_capacity_mw'), 2) . ' MW');
        $this->command->info('ğŸ’° Presupuesto total: â‚¬' . number_format(collect($projects)->sum('budget'), 2));
        $this->command->info('ğŸ“ Ubicaciones: Madrid, Galicia, Zamora, Valencia, Barcelona');
        $this->command->info('ğŸ“Š Datos realistas: Presupuestos, capacidades y cronogramas');
    }
}
